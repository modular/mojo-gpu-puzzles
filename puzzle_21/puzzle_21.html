<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Puzzle 21: GPU Functional Programming Patterns - Mojo üî• GPU Puzzles</title>


        <!-- Custom HTML head -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
            rel="stylesheet">
        
        <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
        
        <link rel="stylesheet" href="../theme/css/custom.css">
        <link rel="stylesheet" href="../theme/css/highlight.css">
        <link rel="stylesheet" id="theme">
        
        <!-- Additional meta tags -->
        <meta property="og:title" content="Mojoüî• GPU Puzzles">
        <meta property="og:description" content="Learn GPU Programming in Mojoüî• Through Interactive Puzzles">
        <meta property="og:image" content="..//puzzles_images/puzzle-mark.svg">
        <meta property="og:url" content="https://builds.modular.com/puzzles">
        <meta name="twitter:card" content="summary">
        <meta name="twitter:image:alt" content="Mojo GPU Puzzles Logo">
        <meta name="twitter:title" content="Mojoüî• GPU Puzzles">
        <meta name="twitter:description" content="Learn GPU Programming in Mojoüî• Through Interactive Puzzles">
        <meta name="twitter:image" content="..//puzzles_images/puzzle-mark.svg">
        <link rel="icon" type="image/png" href="..//puzzles_images/puzzle-mark.svg">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/css/custom.css">
        <link rel="stylesheet" href="../theme/css/highlight.css">
        <link rel="stylesheet" href="../theme/css/tabs.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <button class="collapse-sidebar" aria-label="Collapse sidebar"></button>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Toggle color mode and talk to us buttons -->
        <script>
            document.addEventListener('click', function (event) {
                if (!event.target.matches('.theme-toggle')) return;
                event.preventDefault();
                const prevTheme = theme;
                html.classList.remove(theme);
                const newTheme = prevTheme === 'ayu' ? 'light' : 'ayu'
                html.classList.add(newTheme);
                theme = newTheme
                localStorage.setItem('mdbook-theme', theme);
            }, false);
            document.addEventListener('click', function() {
                if (!event.target.matches('.log-in')) return;
                event.preventDefault();
                window.amplitude.logEvent('LoginClickedFromPuzzles');
                window.open('https://developer.modular.com', '_blank');
            });
        </script>

        <div class="page-header">
            <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                <i class="fa fa-bars"></i>
            </label>
            <div id="menu-bar" class="menu-bar">
                <div class="left-buttons">
                    <div class="logo-section">
                        <a class="desktop-logo-link" href="https://modular.com"></a>
                        <a class="mobile-logo-link" href="https://builds.modular.com"></a>
                        <div class="slash">/</div>
                        <a class="internal-link" ref="/">Puzzles</a>
                    </div>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Dark</button></li>
                        </ul>
                    </div>
                <div class="right-buttons">
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button theme-toggle-btn" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="false" aria-expanded="false">
                        <i class="theme-toggle"></i>
                    </button>
                    <a class="menu-btn print" href="../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a class="menu-btn" href="https://github.com/modular/mojo-gpu-puzzles" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    <button class="secondary-btn log-in">Log in</button>
                </div>
            </div>
        </div>

        <div id="page-wrapper" class="page-wrapper">
            <div class="page">

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <div id="content" class="content">
                    <main>
                        <h1 id="part-v-mojo-functional-patterns---high-level-gpu-programming"><a class="header" href="#part-v-mojo-functional-patterns---high-level-gpu-programming">Part V: Mojo Functional Patterns - High-Level GPU Programming</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Welcome to <strong>Part V: Mojo Functional Patterns</strong>! This section introduces you to Mojo‚Äôs revolutionary approach to GPU programming through <strong>functional patterns</strong> that abstract away low-level complexity while delivering exceptional performance. You‚Äôll master the art of writing clean, efficient parallel code that scales across thousands of GPU threads.</p>
<p><strong>What you‚Äôll achieve:</strong> Transform from manual GPU kernel programming to high-level functional patterns that automatically handle vectorization, memory optimization, and performance tuning.</p>
<p><strong>Key insight:</strong> <em>Modern GPU programming doesn‚Äôt require sacrificing elegance for performance - Mojo‚Äôs functional patterns give you both.</em></p>
<h2 id="what-youll-learn"><a class="header" href="#what-youll-learn">What you‚Äôll learn</a></h2>
<h3 id="gpu-execution-hierarchy"><a class="header" href="#gpu-execution-hierarchy"><strong>GPU execution hierarchy</strong></a></h3>
<p>Understand the fundamental relationship between GPU threads and SIMD operations:</p>
<pre><code>GPU Device
‚îú‚îÄ‚îÄ Grid (your entire problem)
‚îÇ   ‚îú‚îÄ‚îÄ Block 1 (group of threads, shared memory)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Warp 1 (32 threads, lockstep execution) --&gt; We'll learn in Part VI
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Thread 1 ‚Üí SIMD
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Thread 2 ‚Üí SIMD
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (32 threads total)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Warp 2 (32 threads)
‚îÇ   ‚îî‚îÄ‚îÄ Block 2 (independent group)
</code></pre>
<p><strong>What Mojo abstracts for you:</strong></p>
<ul>
<li>Grid/Block configuration automatically calculated</li>
<li>Warp management handled transparently</li>
<li>Thread scheduling optimized automatically</li>
<li>Memory hierarchy optimization built-in</li>
</ul>
<p>üí° <strong>Note</strong>: While this Part focuses on functional patterns, <strong>warp-level programming</strong> and advanced GPU memory management will be covered in detail in <strong><a href="../puzzle_22/puzzle_22.html">Part VI</a></strong>.</p>
<h3 id="four-fundamental-patterns"><a class="header" href="#four-fundamental-patterns"><strong>Four fundamental patterns</strong></a></h3>
<p>Master the complete spectrum of GPU functional programming:</p>
<ol>
<li><strong>Elementwise</strong>: Maximum parallelism with automatic SIMD vectorization</li>
<li><strong>Tiled</strong>: Memory-efficient processing with cache optimization</li>
<li><strong>Manual vectorization</strong>: Expert-level control over SIMD operations</li>
<li><strong>Mojo vectorize</strong>: Safe, automatic vectorization with bounds checking</li>
</ol>
<h3 id="performance-patterns-youll-recognize"><a class="header" href="#performance-patterns-youll-recognize"><strong>Performance patterns you‚Äôll recognize</strong></a></h3>
<pre><code>Problem: Add two 1024-element vectors (SIZE=1024, SIMD_WIDTH=4)

Elementwise:     256 threads √ó 1 SIMD op   = High parallelism
Tiled:           32 threads  √ó 8 SIMD ops  = Cache optimization
Manual:          8 threads   √ó 32 SIMD ops = Maximum control
Mojo vectorize:  32 threads  √ó 8 SIMD ops  = Automatic safety
</code></pre>
<h3 id="-real-performance-insights"><a class="header" href="#-real-performance-insights">üìä <strong>Real performance insights</strong></a></h3>
<p>Learn to interpret empirical benchmark results:</p>
<pre><code>Benchmark Results (SIZE=1,048,576):
elementwise:        11.34ms  ‚Üê Maximum parallelism wins at scale
tiled:              12.04ms  ‚Üê Good balance of locality and parallelism
manual_vectorized:  15.75ms  ‚Üê Complex indexing hurts simple operations
vectorized:         13.38ms  ‚Üê Automatic optimization overhead
</code></pre>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>Before diving into functional patterns, ensure you‚Äôre comfortable with:</p>
<ul>
<li><strong>Basic GPU concepts</strong>: Memory hierarchy, thread execution, SIMD operations</li>
<li><strong>Mojo fundamentals</strong>: Parameter functions, compile-time specialization, capturing semantics</li>
<li><strong>LayoutTensor operations</strong>: Loading, storing, and tensor manipulation</li>
<li><strong>GPU memory management</strong>: Buffer allocation, host-device synchronization</li>
</ul>
<h2 id="learning-path"><a class="header" href="#learning-path">Learning path</a></h2>
<h3 id="1-elementwise-operations"><a class="header" href="#1-elementwise-operations"><strong>1. Elementwise operations</strong></a></h3>
<p><strong>‚Üí <a href="./elementwise.html">Elementwise - Basic GPU Functional Operations</a></strong></p>
<p>Start with the foundation: automatic thread management and SIMD vectorization.</p>
<p><strong>What you‚Äôll master:</strong></p>
<ul>
<li>Functional GPU programming with <code>elementwise</code></li>
<li>Automatic SIMD vectorization within GPU threads</li>
<li>LayoutTensor operations for safe memory access</li>
<li>Capturing semantics in nested functions</li>
</ul>
<p><strong>Key pattern:</strong></p>
<pre><code class="language-mojo">elementwise[add_function, SIMD_WIDTH, target="gpu"](total_size, ctx)
</code></pre>
<h3 id="2-tiled-processing"><a class="header" href="#2-tiled-processing"><strong>2. Tiled processing</strong></a></h3>
<p><strong>‚Üí <a href="./tile.html">Tile - Memory-Efficient Tiled Processing</a></strong></p>
<p>Build on elementwise with memory-optimized tiling patterns.</p>
<p><strong>What you‚Äôll master:</strong></p>
<ul>
<li>Tile-based memory organization for cache optimization</li>
<li>Sequential SIMD processing within tiles</li>
<li>Memory locality principles and cache-friendly access patterns</li>
<li>Thread-to-tile mapping vs thread-to-element mapping</li>
</ul>
<p><strong>Key insight:</strong> Tiling trades parallel breadth for memory locality - fewer threads each doing more work with better cache utilization.</p>
<h3 id="3-advanced-vectorization"><a class="header" href="#3-advanced-vectorization"><strong>3. Advanced vectorization</strong></a></h3>
<p><strong>‚Üí <a href="./vectorize.html">Vectorization - Fine-Grained SIMD Control</a></strong></p>
<p>Explore manual control and automatic vectorization strategies.</p>
<p><strong>What you‚Äôll master:</strong></p>
<ul>
<li>Manual SIMD operations with explicit index management</li>
<li>Mojo‚Äôs vectorize function for safe, automatic vectorization</li>
<li>Chunk-based memory organization for optimal SIMD alignment</li>
<li>Performance trade-offs between manual control and safety</li>
</ul>
<p><strong>Two approaches:</strong></p>
<ul>
<li><strong>Manual</strong>: Direct control, maximum performance, complex indexing</li>
<li><strong>Mojo vectorize</strong>: Automatic optimization, built-in safety, clean code</li>
</ul>
<h3 id="-4-threading-vs-simd-concepts"><a class="header" href="#-4-threading-vs-simd-concepts">üß† <strong>4. Threading vs SIMD concepts</strong></a></h3>
<p><strong>‚Üí <a href="./gpu-thread-vs-simd.html">GPU Threading vs SIMD - Understanding the Execution Hierarchy</a></strong></p>
<p>Understand the fundamental relationship between parallelism levels.</p>
<p><strong>What you‚Äôll master:</strong></p>
<ul>
<li>GPU threading hierarchy and hardware mapping</li>
<li>SIMD operations within GPU threads</li>
<li>Pattern comparison and thread-to-work mapping</li>
<li>Choosing the right pattern for different workloads</li>
</ul>
<p><strong>Key insight:</strong> GPU threads provide the parallelism structure, while SIMD operations provide the vectorization within each thread.</p>
<h3 id="-5-performance-benchmarking-in-mojo"><a class="header" href="#-5-performance-benchmarking-in-mojo">üìä <strong>5. Performance benchmarking in Mojo</strong></a></h3>
<p><strong>‚Üí <a href="./benchmarking.html">Benchmarking in Mojo</a></strong></p>
<p>Learn to measure, analyze, and optimize GPU performance scientifically.</p>
<p><strong>What you‚Äôll master:</strong></p>
<ul>
<li>Mojo‚Äôs built-in benchmarking framework</li>
<li>GPU-specific timing and synchronization challenges</li>
<li>Parameterized benchmark functions with compile-time specialization</li>
<li>Empirical performance analysis and pattern selection</li>
</ul>
<p><strong>Critical technique:</strong> Using <code>keep()</code> to prevent compiler optimization of benchmarked code.</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h2>
<p>Ready to transform your GPU programming skills? Start with the elementwise pattern and work through each section systematically. Each puzzle builds on the previous concepts while introducing new levels of sophistication.</p>
<p>üí° <strong>Success tip</strong>: Focus on understanding the <strong>why</strong> behind each pattern, not just the <strong>how</strong>. The conceptual framework you develop here will serve you throughout your GPU programming career.</p>
<p><strong>Learning objective</strong>: By the end of Part V, you‚Äôll think in terms of functional patterns rather than low-level GPU mechanics, enabling you to write more maintainable, performant, and portable GPU code.</p>
<p><strong>Ready to begin?</strong> Start with <strong><a href="./elementwise.html">Elementwise Operations</a></strong> and discover the power of functional GPU programming!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../puzzle_20/backward_pass.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../puzzle_21/elementwise.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../puzzle_20/backward_pass.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../puzzle_21/elementwise.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/mojolang.js"></script>
        <script src="../theme/sidebar.js"></script>
        <script src="../theme/solution.js"></script>
        <script src="../theme/init-amplitude.js"></script>
        <script src="../theme/tabs.js"></script>


    </div>
    </body>
</html>
