<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Puzzle 29: GPU Synchronization Primitives - Mojo ðŸ”¥ GPU Puzzles</title>


        <!-- Custom HTML head -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
            rel="stylesheet">
        
        <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
        
        <link rel="stylesheet" href="../theme/css/custom.css">
        <link rel="stylesheet" href="../theme/css/highlight.css">
        <link rel="stylesheet" id="theme">
        
        <!-- Additional meta tags -->
        <meta property="og:title" content="MojoðŸ”¥ GPU Puzzles">
        <meta property="og:description" content="Learn GPU Programming in MojoðŸ”¥ Through Interactive Puzzles">
        <meta property="og:image" content="https://puzzles.modular.com/puzzles_images/puzzle-mark.png">
        <meta property="og:url" content="https://puzzles.modular.com/">
        <meta name="twitter:card" content="summary">
        <meta name="twitter:image:alt" content="Mojo GPU Puzzles Logo">
        <meta name="twitter:title" content="MojoðŸ”¥ GPU Puzzles">
        <meta name="twitter:description" content="Learn GPU Programming in MojoðŸ”¥ Through Interactive Puzzles">
        <meta name="twitter:image" content="https://puzzles.modular.com/puzzles_images/puzzle-mark.png">
        <link rel="icon" type="image/png" href="https://puzzles.modular.com/puzzles_images/puzzle-mark.png">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/css/custom.css">
        <link rel="stylesheet" href="../theme/css/highlight.css">
        <link rel="stylesheet" href="../theme/css/tabs.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <button class="collapse-sidebar" aria-label="Collapse sidebar"></button>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Toggle color mode and talk to us buttons -->
        <script>
            document.addEventListener('click', function (event) {
                if (!event.target.matches('.theme-toggle')) return;
                event.preventDefault();
                const prevTheme = theme;
                html.classList.remove(theme);
                const newTheme = prevTheme === 'ayu' ? 'light' : 'ayu'
                html.classList.add(newTheme);
                theme = newTheme
                localStorage.setItem('mdbook-theme', theme);
            }, false);
            document.addEventListener('click', function() {
                if (!event.target.matches('.log-in')) return;
                event.preventDefault();
                window.amplitude.logEvent('LoginClickedFromPuzzles');
                window.open('https://developer.modular.com', '_blank');
            });
        </script>

        <div class="page-header">
            <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                <i class="fa fa-bars"></i>
            </label>
            <div id="menu-bar" class="menu-bar">
                <div class="left-buttons">
                    <div class="logo-section">
                        <a class="desktop-logo-link" href="https://modular.com"></a>
                        <a class="mobile-logo-link" href="https://builds.modular.com"></a>
                        <div class="slash">/</div>
                        <a class="internal-link" ref="/">Puzzles</a>
                    </div>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Dark</button></li>
                        </ul>
                    </div>
                <div class="right-buttons">
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button theme-toggle-btn" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="false" aria-expanded="false">
                        <i class="theme-toggle"></i>
                    </button>
                    <a class="menu-btn print" href="../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a class="menu-btn" href="https://github.com/modular/mojo-gpu-puzzles" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    <button class="secondary-btn log-in">Log in</button>
                </div>
            </div>
        </div>

        <div id="page-wrapper" class="page-wrapper">
            <div class="page">

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <div id="content" class="content">
                    <main>
                        <h1 id="puzzle-29-gpu-synchronization-primitives"><a class="header" href="#puzzle-29-gpu-synchronization-primitives">Puzzle 29: GPU Synchronization Primitives</a></h1>
<blockquote>
<p><strong>Beyond Simple Parallelism</strong></p>
<p>This chapter introduces <strong>synchronization patterns</strong> that enable complex GPU algorithms requiring precise coordination between threads. Unlike previous puzzles that focused on simple parallel operations, these challenges explore <strong>architectural approaches</strong> used in production GPU software.</p>
<p><strong>What youâ€™ll learn:</strong></p>
<ul>
<li><strong>Thread specialization</strong>: Different thread groups executing distinct algorithms within a single block</li>
<li><strong>Producer-consumer pipelines</strong>: Multi-stage processing with explicit data dependencies</li>
<li><strong>Advanced barrier APIs</strong>: Fine-grained synchronization control beyond basic <code>barrier()</code> calls</li>
<li><strong>Memory barrier coordination</strong>: Explicit control over memory visibility and ordering</li>
<li><strong>Iterative algorithm patterns</strong>: Double-buffering and pipeline coordination for complex computations</li>
</ul>
<p><strong>Why this matters:</strong> Most GPU tutorials teach simple data-parallel patterns, but real-world applications require <strong>sophisticated coordination</strong> between different processing phases, memory access patterns, and algorithmic stages. These puzzles bridge the gap between academic examples and production GPU computing.</p>
</blockquote>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>GPU synchronization is the foundation that enables complex parallel algorithms to work correctly and efficiently. This chapter explores three fundamental synchronization patterns that appear throughout high-performance GPU computing: <strong>pipeline coordination</strong>, <strong>memory barrier management</strong>, and <strong>streaming computation</strong>.</p>
<p><strong>Core learning objectives:</strong></p>
<ul>
<li><strong>Understand when and why</strong> different synchronization primitives are needed</li>
<li><strong>Design multi-stage algorithms</strong> with proper thread specialization</li>
<li><strong>Implement iterative patterns</strong> that require precise memory coordination</li>
<li><strong>Optimize synchronization overhead</strong> while maintaining correctness guarantees</li>
</ul>
<p><strong>Architectural progression:</strong> These puzzles follow a carefully designed progression from basic pipeline coordination to advanced memory barrier management, culminating in streaming computation patterns used in high-throughput applications.</p>
<h2 id="key-concepts"><a class="header" href="#key-concepts">Key concepts</a></h2>
<p><strong>Thread coordination paradigms:</strong></p>
<ul>
<li><strong>Simple parallelism</strong>: All threads execute identical operations (previous puzzles)</li>
<li><strong>Specialized parallelism</strong>: Different thread groups execute distinct algorithms (this chapter)</li>
<li><strong>Pipeline parallelism</strong>: Sequential stages with producer-consumer relationships</li>
<li><strong>Iterative parallelism</strong>: Multiple passes with careful buffer management</li>
</ul>
<p><strong>Synchronization primitive hierarchy:</strong></p>
<ul>
<li><strong>Basic <a href="https://docs.modular.com/mojo/stdlib/gpu/sync/#barrier"><code>barrier()</code></a></strong>: Simple thread synchronization within blocks</li>
<li><strong>Advanced <a href="https://docs.modular.com/mojo/stdlib/gpu/sync/">mbarrier APIs</a></strong>: Fine-grained memory barrier control with state tracking</li>
<li><strong>Streaming coordination</strong>: Asynchronous copy and bulk transfer synchronization</li>
</ul>
<p><strong>Memory consistency models:</strong></p>
<ul>
<li><strong>Shared memory coordination</strong>: Fast on-chip memory for inter-thread communication</li>
<li><strong>Global memory ordering</strong>: Ensuring visibility of writes across different memory spaces</li>
<li><strong>Buffer management</strong>: Double-buffering and ping-pong patterns for iterative algorithms</li>
</ul>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p><strong>System architecture:</strong></p>
<ul>
<li><strong>Block size</strong>: <code>TPB = 256</code> threads per block for optimal occupancy</li>
<li><strong>Grid configuration</strong>: Multiple blocks processing different data tiles</li>
<li><strong>Memory hierarchy</strong>: Strategic use of shared memory, registers, and global memory</li>
<li><strong>Data types</strong>: <code>DType.float32</code> for numerical computations</li>
</ul>
<p><strong>Synchronization patterns covered:</strong></p>
<ol>
<li><strong>Multi-stage pipelines</strong>: Thread specialization with barrier coordination</li>
<li><strong>Double-buffered iterations</strong>: Memory barrier management for iterative algorithms</li>
<li><strong>Streaming computation</strong>: Asynchronous copy coordination for high-throughput processing</li>
</ol>
<p><strong>Performance considerations:</strong></p>
<ul>
<li><strong>Synchronization overhead</strong>: Understanding the cost of different barrier types</li>
<li><strong>Memory bandwidth</strong>: Optimizing access patterns for maximum throughput</li>
<li><strong>Thread utilization</strong>: Balancing specialized roles with overall efficiency</li>
</ul>
<h2 id="puzzle-structure"><a class="header" href="#puzzle-structure">Puzzle structure</a></h2>
<p>This chapter contains three interconnected puzzles that build upon each other:</p>
<h3 id="multi-stage-pipeline-coordination"><a class="header" href="#multi-stage-pipeline-coordination"><strong><a href="barrier.html">Multi-Stage Pipeline Coordination</a></strong></a></h3>
<p><strong>Focus</strong>: Thread specialization and pipeline architecture</p>
<p>Learn how to design GPU kernels where different thread groups execute completely different algorithms within the same block. This puzzle introduces <strong>producer-consumer relationships</strong> and strategic barrier placement for coordinating between different algorithmic stages.</p>
<p><strong>Key concepts</strong>:</p>
<ul>
<li>Thread role specialization (Stage 1: load, Stage 2: process, Stage 3: output)</li>
<li>Producer-consumer data flow between processing stages</li>
<li>Strategic barrier placement between different algorithms</li>
</ul>
<p><strong>Real-world applications</strong>: Image processing pipelines, multi-stage scientific computations, neural network layer coordination</p>
<h3 id="double-buffered-stencil-computation"><a class="header" href="#double-buffered-stencil-computation"><strong><a href="memory_barrier.html">Double-Buffered Stencil Computation</a></strong></a></h3>
<p><strong>Focus</strong>: Advanced memory barrier APIs and iterative processing</p>
<p>Explore <strong>fine-grained synchronization control</strong> using <a href="https://docs.modular.com/mojo/stdlib/gpu/sync/">mbarrier APIs</a> for iterative algorithms that require precise memory coordination. This puzzle demonstrates double-buffering patterns essential for iterative solvers and simulation algorithms.</p>
<p><strong>Key concepts</strong>:</p>
<ul>
<li>Advanced <a href="https://docs.modular.com/mojo/stdlib/gpu/sync/">mbarrier APIs</a> vs basic <a href="https://docs.modular.com/mojo/stdlib/gpu/sync/#barrier"><code>barrier()</code></a></li>
<li>Double-buffering with alternating read/write buffer roles</li>
<li>Iterative algorithm coordination with explicit memory barriers</li>
</ul>
<p><strong>Real-world applications</strong>: Iterative solvers (Jacobi, Gauss-Seidel), cellular automata, simulation time-stepping</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h2>
<p><strong>Recommended approach:</strong></p>
<ol>
<li><strong>Start with <a href="barrier.html">Pipeline Coordination</a></strong>: Understand thread specialization basics</li>
<li><strong>Progress to <a href="memory_barrier.html">Memory Barriers</a></strong>: Master fine-grained synchronization control</li>
<li><strong>Apply to streaming patterns</strong>: Combine concepts for high-throughput applications</li>
</ol>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>Comfort with basic GPU programming concepts (threads, blocks, shared memory)</li>
<li>Understanding of memory hierarchies and access patterns</li>
<li>Familiarity with barrier synchronization from previous puzzles</li>
</ul>
<p><strong>Learning outcomes:</strong>
By completing this chapter, youâ€™ll have the foundation to design and implement sophisticated GPU algorithms that require precise coordination, preparing you for the architectural complexity found in production GPU computing applications.</p>
<p><strong>Ready to dive in?</strong> Start with <strong><a href="barrier.html">Multi-Stage Pipeline Coordination</a></strong> to learn thread specialization fundamentals, then advance to <strong><a href="memory_barrier.html">Double-Buffered Stencil Computation</a></strong> for advanced memory barrier mastery.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../puzzle_28/puzzle_28.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../puzzle_29/barrier.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../puzzle_28/puzzle_28.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../puzzle_29/barrier.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/mojolang.js"></script>
        <script src="../theme/sidebar.js"></script>
        <script src="../theme/solution.js"></script>
        <script src="../theme/init-amplitude.js"></script>
        <script src="../theme/tabs.js"></script>


    </div>
    </body>
</html>
