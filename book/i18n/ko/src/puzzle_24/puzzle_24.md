<!-- i18n-source-commit: 43fce1182f8029e7edc50157aed0e6ebb8129d42 -->

# Puzzle 24: Warp ê¸°ì´ˆ

## ê°œìš”

**Part VII: Warp ë ˆë²¨ í”„ë¡œê·¸ëž˜ë°**ì—ì„œëŠ” GPUì˜ **Warp ë ˆë²¨ ê¸°ë³¸ ìš”ì†Œ** - Warp ë‚´ ë™ê¸°í™”ëœ ìŠ¤ë ˆë“œ ì‹¤í–‰ì„ í™œìš©í•˜ëŠ” í•˜ë“œì›¨ì–´ ê°€ì† ì—°ì‚°ì„ ì†Œê°œí•©ë‹ˆë‹¤. ë³µìž¡í•œ ê³µìœ  ë©”ëª¨ë¦¬ íŒ¨í„´ì„ ê°„ë‹¨í•˜ê³  íš¨ìœ¨ì ì¸ í•¨ìˆ˜ í˜¸ì¶œë¡œ ëŒ€ì²´í•˜ëŠ” ë‚´ìž¥ Warp ì—°ì‚°ì„ ë°°ì›ë‹ˆë‹¤.

**ëª©í‘œ:** ë³µìž¡í•œ ê³µìœ  ë©”ëª¨ë¦¬ + barrier + íŠ¸ë¦¬ reduction íŒ¨í„´ì„ í•˜ë“œì›¨ì–´ ë™ê¸°í™”ë¥¼ í™œìš©í•˜ëŠ” íš¨ìœ¨ì ì¸ Warp ê¸°ë³¸ ìš”ì†Œ í˜¸ì¶œë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.

**í•µì‹¬ í†µì°°:** _GPU WarpëŠ” lockstepìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤ - Mojoì˜ Warp ì—°ì‚°ì€ ì´ ë™ê¸°í™”ë¥¼ í™œìš©í•˜ì—¬ ëª…ì‹œì  ë™ê¸°í™” ì—†ì´ ê°•ë ¥í•œ ë³‘ë ¬ ê¸°ë³¸ ìš”ì†Œë¥¼ ì œê³µí•©ë‹ˆë‹¤._

## ë°°ìš¸ ë‚´ìš©

### **GPU Warp ì‹¤í–‰ ëª¨ë¸**

GPU ë³‘ë ¬ì„±ì˜ ê¸°ë³¸ í•˜ë“œì›¨ì–´ ë‹¨ìœ„ë¥¼ ì´í•´í•©ë‹ˆë‹¤:

```
GPU ë¸”ë¡ (ì˜ˆ: 256 ìŠ¤ë ˆë“œ)
â”œâ”€â”€ Warp 0 (32 ìŠ¤ë ˆë“œ, SIMT lockstep ì‹¤í–‰)
â”‚   â”œâ”€â”€ Lane 0  â”€â”
â”‚   â”œâ”€â”€ Lane 1   â”‚ ëª¨ë“  ìŠ¤ë ˆë“œê°€ ê°™ì€ ëª…ë ¹ì„
â”‚   â”œâ”€â”€ Lane 2   â”‚ ë™ì‹œì— ì‹¤í–‰ (SIMT)
â”‚   â”‚   ...      â”‚
â”‚   â””â”€â”€ Lane 31 â”€â”˜
â”œâ”€â”€ Warp 1 (32 ìŠ¤ë ˆë“œ, ë…ë¦½ì )
â”œâ”€â”€ Warp 2 (32 ìŠ¤ë ˆë“œ, ë…ë¦½ì )
â””â”€â”€ ...
```

**í•˜ë“œì›¨ì–´ í˜„ì‹¤:**

- NVIDIA GPUì—ì„œ **Warpë‹¹ 32 ìŠ¤ë ˆë“œ** (`WARP_SIZE=32`)
- AMD GPUì—ì„œ **Warpë‹¹ 32 ë˜ëŠ” 64 ìŠ¤ë ˆë“œ** (`WARP_SIZE=32 or 64`)
- **Lockstep ì‹¤í–‰**: Warp ë‚´ ëª¨ë“  ìŠ¤ë ˆë“œê°€ ë™ì¼í•œ ëª…ë ¹ì„ ë™ì‹œì— ì‹¤í–‰í•©ë‹ˆë‹¤
- **ë™ê¸°í™” ë¹„ìš© ì œë¡œ**: Warp ì—°ì‚°ì€ ê° Warp ë‚´ì—ì„œ ì¦‰ì‹œ ìˆ˜í–‰ë©ë‹ˆë‹¤

### **Mojoì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ Warp ì—°ì‚°**

`gpu.primitives.warp`ì˜ í•µì‹¬ Warp ê¸°ë³¸ ìš”ì†Œë¥¼ ë°°ì›ë‹ˆë‹¤:

1. **`sum(value)`**: Warpì˜ ëª¨ë“  Laneì—ì„œ ê°’ì„ í•©ì‚°
2. **`shuffle_idx(value, lane)`**: íŠ¹ì • Laneì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ê¸°
3. **`shuffle_down(value, delta)`**: lane+delta ìœ„ì¹˜ì˜ ê°’ì„ ê°€ì ¸ì˜¤ê¸°
4. **`prefix_sum(value)`**: Lane ì „ì²´ì— ê±¸ì³ prefix sum ê³„ì‚°
5. **`lane_id()`**: í˜„ìž¬ ìŠ¤ë ˆë“œì˜ Lane ë²ˆí˜¸ ë°˜í™˜ (0-31 ë˜ëŠ” 0-63)

### **ì„±ëŠ¥ ë³€í™˜ ì˜ˆì‹œ**

```mojo
# 1. ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ í†µí•œ reduction
# ì•žì„œ ì‚´íŽ´ë³¸ ë³µìž¡í•œ íŒ¨í„´ (p12.mojo):
shared = LayoutTensor[
    dtype,
    Layout.row_major(WARP_SIZE),
    MutAnyOrigin,
    address_space = AddressSpace.SHARED,
].stack_allocation()
shared[local_i] = partial_product
barrier()

# ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ í†µí•œ ì•ˆì „í•œ íŠ¸ë¦¬ reductionì€ ê° ë‹¨ê³„ë§ˆë‹¤ barrierê°€ í•„ìš”í•©ë‹ˆë‹¤:
stride = WARP_SIZE // 2
while stride > 0:
    if local_i < stride:
        shared[local_i] += shared[local_i + stride]

    barrier()
    stride //= 2

# 2. Warp ê¸°ë³¸ ìš”ì†Œë¥¼ í™œìš©í•œ reduction
# Warp ê¸°ë³¸ ìš”ì†Œë¥¼ ì‚¬ìš©í•œ ì•ˆì „í•œ íŠ¸ë¦¬ reductionì€ ê³µìœ  ë©”ëª¨ë¦¬ë‚˜ ê° ë‹¨ê³„ì˜ barrierê°€
# í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
# Mojoì˜ Warp ë ˆë²¨ sum ì—°ì‚°ì€ ë‚´ë¶€ì ìœ¼ë¡œ Warp ê¸°ë³¸ ìš”ì†Œë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ëª¨ë“  ë³µìž¡ì„±ì„
# ìˆ¨ê¹ë‹ˆë‹¤:
total = sum(partial_product)  # ë‚´ë¶€ì ìœ¼ë¡œ barrierë„, ê²½ìŸ ìƒíƒœë„ ì—†ìŠµë‹ˆë‹¤!
```

### **Warp ì—°ì‚°ì´ ë¹›ë‚˜ëŠ” ìˆœê°„**

ì„±ëŠ¥ íŠ¹ì„±ì„ ì´í•´í•©ë‹ˆë‹¤:

```
ë¬¸ì œ ê·œëª¨              ê¸°ì¡´ ë°©ì‹        Warp ì—°ì‚°
ë‹¨ì¼ Warp (32)        ë¹ ë¦„            ê°€ìž¥ ë¹ ë¦„ (barrier ì—†ìŒ)
ì†Œìˆ˜ Warp (128)       ì¢‹ìŒ            ìš°ìˆ˜ (ì˜¤ë²„í—¤ë“œ ìµœì†Œ)
ë‹¤ìˆ˜ Warp (1024+)     ì¢‹ìŒ            ë›°ì–´ë‚¨ (ì„ í˜• í™•ìž¥)
ëŒ€ê·œëª¨ (16K+)         ë³‘ëª© ë°œìƒ        ë©”ëª¨ë¦¬ ëŒ€ì—­í­ ì œí•œ
```

## ì„ ìˆ˜ ì§€ì‹

Warp í”„ë¡œê·¸ëž˜ë°ì— ë“¤ì–´ê°€ê¸° ì „ì— ë‹¤ìŒ ë‚´ìš©ì— ìµìˆ™í•´ì•¼ í•©ë‹ˆë‹¤:

- **Part VI í•¨ìˆ˜í˜• íŒ¨í„´**: Elementwise, tiled, vectorize ì ‘ê·¼ ë°©ì‹
- **GPU ìŠ¤ë ˆë“œ ê³„ì¸µ êµ¬ì¡°**: ë¸”ë¡, Warp, ìŠ¤ë ˆë“œì— ëŒ€í•œ ì´í•´
- **LayoutTensor ì—°ì‚°**: ë¡œë“œ, ì €ìž¥, í…ì„œ ì¡°ìž‘
- **ê³µìœ  ë©”ëª¨ë¦¬ ê°œë…**: barrierì™€ íŠ¸ë¦¬ reductionì´ ì™œ ë³µìž¡í•œì§€

## í•™ìŠµ ê²½ë¡œ

### **1. SIMT ì‹¤í–‰ ëª¨ë¸**

**â†’ [Warp Laneê³¼ SIMT ì‹¤í–‰](./warp_simt.md)**

Warp ì—°ì‚°ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” í•˜ë“œì›¨ì–´ ê¸°ë°˜ì„ ì´í•´í•©ë‹ˆë‹¤.

**ë°°ìš¸ ë‚´ìš©:**

- SIMT(Single Instruction, Multiple Thread) ì‹¤í–‰ ëª¨ë¸
- Warp ë¶„ê¸°ì™€ ìˆ˜ë ´ íŒ¨í„´
- Warp ë‚´ Lane ë™ê¸°í™”
- í•˜ë“œì›¨ì–´ vs ì†Œí”„íŠ¸ì›¨ì–´ ìŠ¤ë ˆë“œ ê´€ë¦¬

**í•µì‹¬ í†µì°°:** WarpëŠ” GPU ì‹¤í–‰ì˜ ê¸°ë³¸ ë‹¨ìœ„ìž…ë‹ˆë‹¤ - SIMTë¥¼ ì´í•´í•˜ë©´ Warp í”„ë¡œê·¸ëž˜ë°ì˜ ë¬¸ì´ ì—´ë¦½ë‹ˆë‹¤.

### **2. Warp sum ê¸°ì´ˆ**

**â†’ [warp.sum()ì˜ í•µì‹¬](./warp_sum.md)**

ë‚´ì  êµ¬í˜„ì„ í†µí•´ ê°€ìž¥ ì¤‘ìš”í•œ Warp ì—°ì‚°ì„ ë°°ì›ë‹ˆë‹¤.

**ë°°ìš¸ ë‚´ìš©:**

- ê³µìœ  ë©”ëª¨ë¦¬ + barrierë¥¼ `sum()`ìœ¼ë¡œ ëŒ€ì²´
- GPU ì•„í‚¤í…ì²˜ ê°„ í˜¸í™˜ì„± (`WARP_SIZE`)
- Warpë¥¼ í™œìš©í•œ kernel vs í•¨ìˆ˜í˜• í”„ë¡œê·¸ëž˜ë° íŒ¨í„´
- ê¸°ì¡´ ë°©ì‹ê³¼ì˜ ì„±ëŠ¥ ë¹„êµ

**í•µì‹¬ íŒ¨í„´:**

```mojo
partial_result = compute_per_lane_value()
total = sum(partial_result)  # ë§ˆë²•ì´ ì¼ì–´ë‚˜ëŠ” ê³³!
if lane_id() == 0:
    output[0] = total
```

### **3. ì–¸ì œ Warp í”„ë¡œê·¸ëž˜ë°ì„ ì‚¬ìš©í• ê¹Œ**

**â†’ [ì–¸ì œ Warp í”„ë¡œê·¸ëž˜ë°ì„ ì‚¬ìš©í• ê¹Œ](./warp_extra.md)**

ëŒ€ì•ˆ ëŒ€ë¹„ Warp ì—°ì‚°ì„ ì„ íƒí•˜ê¸° ìœ„í•œ ì˜ì‚¬ê²°ì • í”„ë ˆìž„ì›Œí¬ë¥¼ ë°°ì›ë‹ˆë‹¤.

**ë°°ìš¸ ë‚´ìš©:**

- Warp ì—°ì‚°ì— ìœ ë¦¬í•œ ë¬¸ì œ íŠ¹ì„±
- Warp ìˆ˜ì— ë”°ë¥¸ ì„±ëŠ¥ í™•ìž¥ íŒ¨í„´
- ë©”ëª¨ë¦¬ ëŒ€ì—­í­ vs ì—°ì‚°ëŸ‰ íŠ¸ë ˆì´ë“œì˜¤í”„
- Warp ì—°ì‚° ì„ íƒ ê°€ì´ë“œë¼ì¸

**ì˜ì‚¬ê²°ì • í”„ë ˆìž„ì›Œí¬:** reduction ì—°ì‚°ì´ ë³‘ëª©ì´ ë  ë•Œ, Warp ê¸°ë³¸ ìš”ì†Œê°€ ëŒíŒŒêµ¬ë¥¼ ì œê³µí•˜ëŠ” ê²½ìš°ê°€ ë§ŽìŠµë‹ˆë‹¤.

## í•µì‹¬ ê°œë…

### **í•˜ë“œì›¨ì–´-ì†Œí”„íŠ¸ì›¨ì–´ ì •ë ¬**

Mojo Warp ì—°ì‚°ì´ GPU í•˜ë“œì›¨ì–´ì— ë§¤í•‘ë˜ëŠ” ë°©ì‹ì„ ì´í•´í•©ë‹ˆë‹¤:

- **SIMT ì‹¤í–‰**: ëª¨ë“  Laneì´ ë™ì¼í•œ ëª…ë ¹ì„ ë™ì‹œì— ì‹¤í–‰í•©ë‹ˆë‹¤
- **ë‚´ìž¥ ë™ê¸°í™”**: Warp ë‚´ì—ì„œ ëª…ì‹œì  barrierê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
- **í¬ë¡œìŠ¤ ì•„í‚¤í…ì²˜ ì§€ì›**: `WARP_SIZE`ê°€ NVIDIAì™€ AMDì˜ ì°¨ì´ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤

### **íŒ¨í„´ ë³€í™˜**

ë³µìž¡í•œ ë³‘ë ¬ íŒ¨í„´ì„ Warp ê¸°ë³¸ ìš”ì†Œë¡œ ë³€í™˜í•©ë‹ˆë‹¤:

- **íŠ¸ë¦¬ reduction** â†’ `sum()`
- **Prefix ì—°ì‚°** â†’ `prefix_sum()`
- **ë°ì´í„° shuffle** â†’ `shuffle_idx()`, `shuffle_down()`

### **ì„±ëŠ¥ íŠ¹ì„±**

Warp ì—°ì‚°ì´ ì´ì ì„ ì œê³µí•˜ëŠ” ê²½ìš°ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤:

- **ì†Œ~ì¤‘ê·œëª¨ ë¬¸ì œ**: barrier ì˜¤ë²„í—¤ë“œë¥¼ ì œê±°í•©ë‹ˆë‹¤
- **ëŒ€ê·œëª¨ ë¬¸ì œ**: ë©”ëª¨ë¦¬ íŠ¸ëž˜í”½ì„ ì¤„ì´ê³  ìºì‹œ í™œìš©ì„ ê°œì„ í•©ë‹ˆë‹¤
- **ê·œì¹™ì ì¸ íŒ¨í„´**: ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì ‘ê·¼ íŒ¨í„´ì—ì„œ Warp ì—°ì‚°ì´ íƒì›”í•©ë‹ˆë‹¤

## ì‹œìž‘í•˜ê¸°

SIMT ì‹¤í–‰ ëª¨ë¸ì„ ì´í•´í•˜ëŠ” ê²ƒìœ¼ë¡œ ì‹œìž‘í•˜ì—¬, ì‹¤ìš©ì ì¸ Warp sum êµ¬í˜„ì„ ë‹¤ë£¨ê³ , ì „ëžµì  ì˜ì‚¬ê²°ì • í”„ë ˆìž„ì›Œí¬ë¡œ ë§ˆë¬´ë¦¬í•©ë‹ˆë‹¤.

ðŸ’¡ **ì„±ê³µ íŒ**: Warpë¥¼ ë…ë¦½ì ì¸ ìŠ¤ë ˆë“œê°€ ì•„ë‹Œ **ë™ê¸°í™”ëœ ë²¡í„° ìœ ë‹›**ìœ¼ë¡œ ìƒê°í•˜ì„¸ìš”. ì´ ë©˜íƒˆ ëª¨ë¸ì´ íš¨ê³¼ì ì¸ Warp í”„ë¡œê·¸ëž˜ë° íŒ¨í„´ìœ¼ë¡œ ì•ˆë‚´í•  ê²ƒìž…ë‹ˆë‹¤.

**í•™ìŠµ ëª©í‘œ**: Part VIIì„ ë§ˆì¹˜ë©´, Warp ì—°ì‚°ì´ ë³µìž¡í•œ ë™ê¸°í™” íŒ¨í„´ì„ ëŒ€ì²´í•  ìˆ˜ ìžˆëŠ” ìƒí™©ì„ ì¸ì‹í•˜ì—¬ ë” ê°„ë‹¨í•˜ê³  ë¹ ë¥¸ GPU ì½”ë“œë¥¼ ìž‘ì„±í•  ìˆ˜ ìžˆê²Œ ë©ë‹ˆë‹¤.

**ì‹œìž‘í•˜ê¸°**: **[Warp Laneê³¼ SIMT ì‹¤í–‰](./warp_simt.md)** ì—ì„œ Warp ë ˆë²¨ í”„ë¡œê·¸ëž˜ë°ì˜ íž˜ì„ ë§Œë‚˜ë³´ì„¸ìš”!
