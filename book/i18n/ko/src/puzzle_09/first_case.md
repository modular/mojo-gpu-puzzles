<!-- i18n-source-commit: 3711cbf0f794001097a09faed0075ed062023569 -->

# π§ νƒμ • μμ‚¬: μ²« λ²μ§Έ μ‚¬λ΅€

## κ°μ”

μ΄λ² νΌμ¦μ—μ„λ” ν¬λμ‹κ°€ λ°μƒν•λ” GPU ν”„λ΅κ·Έλ¨μ΄ μ£Όμ–΄μ§‘λ‹λ‹¤. μ†μ¤ μ½”λ“λ¥Ό λ³΄μ§€ μ•κ³  `(cuda-gdb)` λ””λ²„κΉ… λ„κµ¬λ§μΌλ΅ λ¬Έμ λ¥Ό μ°Ύμ•„λ‚΄μ•Ό ν•©λ‹λ‹¤. λ””λ²„κΉ… μ¤ν‚¬μ„ λ°νν•΄ λ―Έμ¤ν„°λ¦¬λ¥Ό ν’€μ–΄λ³΄μ„Έμ”!

**μ‚¬μ „ μ¤€λΉ„**: [Mojo GPU λ””λ²„κΉ…μ ν•µμ‹¬](./essentials.md)μ„ λ¨Όμ € μ™„λ£ν•΄μ„ CUDA-GDB μ„¤μ •κ³Ό κΈ°λ³Έ λ””λ²„κΉ… λ…λ Ήμ–΄λ¥Ό μµν€λ‘μ„Έμ”. μ•„λ λ…λ Ήμ„ μ‹¤ν–‰ν–λ”μ§€ ν™•μΈν•μ„Έμ”:

```bash
pixi run -e nvidia setup-cuda-gdb
```

μ΄ λ…λ Ήμ€ μ‹μ¤ν…μ CUDA μ„¤μΉλ¥Ό μλ™μΌλ΅ κ°μ§€ν•κ³  GPU λ””λ²„κΉ…μ— ν•„μ”ν• λ§ν¬λ¥Ό μ„¤μ •ν•©λ‹λ‹¤.

## ν•µμ‹¬ κ°λ…

μ΄λ² λ””λ²„κΉ… μ±λ¦°μ§€μ—μ„ λ°°μΈ λ‚΄μ©:

- **μ²΄κ³„μ μΈ λ””λ²„κΉ…**: μ¤λ¥ λ©”μ‹μ§€λ¥Ό λ‹¨μ„ μ‚Όμ•„ κ·Όλ³Έ μ›μΈ μ°ΎκΈ°
- **μ¤λ¥ λ¶„μ„**: ν¬λμ‹ λ©”μ‹μ§€μ™€ stack trace (_μ—­μ£Ό: μ¤λ¥ λ°μƒ μ‹μ κΉμ§€μ ν•¨μ νΈμ¶ κ²½λ΅_) ν•΄μ„ν•κΈ°
- **κ°€μ„¤ μλ¦½**: λ¬Έμ μ— λ€ν• ν•©λ¦¬μ μΈ μ¶”μΈ΅ μ„Έμ°κΈ°
- **λ””λ²„κΉ… μ›ν¬ν”λ΅μ°**: λ‹¨κ³„λ³„ μ΅°μ‚¬ κ³Όμ • μµνκΈ°

## μ½”λ“ μ‹¤ν–‰

λ¨Όμ € μ „μ²΄ μ½”λ“λ¥Ό λ³΄μ§€ μ•κ³  kernelλ§ μ‚΄ν΄λ΄…μ‹λ‹¤:

```mojo
{{#include ../../../../../problems/p09/p09.mojo:first_crash}}
```

λ²„κ·Έλ¥Ό μ§μ ‘ κ²½ν—ν•λ ¤λ©΄ ν„°λ―Έλ„μ—μ„ λ‹¤μ λ…λ Ήμ„ μ‹¤ν–‰ν•μ„Έμ” (`pixi` μ „μ©):

```bash
pixi run -e nvidia p09 --first-case
```

ν”„λ΅κ·Έλ¨μ΄ ν¬λμ‹ν•λ©΄ λ‹¤μκ³Ό κ°™μ€ μ¶λ ¥μ΄ λ‚νƒ€λ‚©λ‹λ‹¤:

```txt
First Case: Try to identify what's wrong without looking at the code!

stack trace was not collected. Enable stack trace collection with environment variable `MOJO_ENABLE_STACK_TRACE_ON_ERROR`
Unhandled exception caught during execution: At open-source/max/mojo/stdlib/stdlib/gpu/host/device_context.mojo:2082:17: CUDA call failed: CUDA_ERROR_INVALID_IMAGE (device kernel image is invalid)
To get more accurate error information, set MODULAR_DEVICE_CONTEXT_SYNC_MODE=true.
/home/ubuntu/workspace/mojo-gpu-puzzles/.pixi/envs/nvidia/bin/mojo: error: execution exited with a non-zero result: 1
```

## κ³Όμ : νƒμ • μμ‚¬

**λ„μ „**: μ½”λ“λ¥Ό λ³΄μ§€ μ•μ€ μƒνƒμ—μ„, μ΄ ν¬λμ‹λ¥Ό μ΅°μ‚¬ν•κΈ° μ„ν• λ””λ²„κΉ… μ „λµμ€ λ¬΄μ—‡μΌκΉμ”?

λ‹¤μ λ…λ ΉμΌλ΅ μ‹μ‘ν•΄ λ³΄μ„Έμ”:

```bash
pixi run -e nvidia mojo debug --cuda-gdb --break-on-launch problems/p09/p09.mojo --first-case
```

<details>
<summary><strong>ν</strong></summary>

<div class="solution-tips">

1. **ν¬λμ‹ λ©”μ‹μ§€λ¥Ό κΌΌκΌΌν μ½κΈ°** - `CUDA_ERROR_ILLEGAL_ADDRESS`λ” GPUκ°€ μλ»λ λ©”λ¨λ¦¬μ— μ ‘κ·Όν•λ ¤ ν–λ‹¤λ” λ»μ…λ‹λ‹¤
2. **λΈλ μ΄ν¬ν¬μΈνΈ μ •λ³΄ ν™•μΈ** - CUDA-GDBκ°€ λ©μ¶ λ• ν‘μ‹λλ” ν•¨μ νλΌλ―Έν„°λ¥Ό μ‚΄ν΄λ³΄μ„Έμ”
3. **λ¨λ“  ν¬μΈν„°λ¥Ό μ²΄κ³„μ μΌλ΅ κ²€μ‚¬** - `print`λ΅ κ° ν¬μΈν„° νλΌλ―Έν„°λ¥Ό ν™•μΈν•μ„Έμ”
4. **μμƒν• μ£Όμ† μ°ΎκΈ°** - μ ν¨ν• GPU μ£Όμ†λ” λ³΄ν†µ ν° 16μ§„μμ…λ‹λ‹¤ (`0x0`μ€ λ¬΄μ—‡μ„ μλ―Έν• κΉμ”?)
5. **λ©”λ¨λ¦¬ μ ‘κ·Ό ν…μ¤νΈ** - κ° ν¬μΈν„°λ΅ λ°μ΄ν„°μ— μ ‘κ·Όν•΄μ„ μ–΄λ κ²ƒμ΄ μ‹¤ν¨ν•λ”μ§€ ν™•μΈν•μ„Έμ”
6. **μ²΄κ³„μ μΌλ΅ μ ‘κ·Ό** - νƒμ •μ²λΌ μ¦κ±°λ¥Ό λ”°λΌκ°€λ©° μ¦μƒμ—μ„ κ·Όλ³Έ μ›μΈκΉμ§€ μ¶”μ ν•μ„Έμ”
7. **μ ν¨ν• ν¨ν„΄κ³Ό κ·Έλ ‡μ§€ μ•μ€ ν¨ν„΄ λΉ„κµ** - ν• ν¬μΈν„°κ°€ μ‘λ™ν•κ³  λ‹¤λ¥Έ κ±΄ μ• λλ‹¤λ©΄, λ¬Έμ κ°€ μλ” μ½μ— μ§‘μ¤‘ν•μ„Έμ”

</div>
</details>

<details class="solution-details">
<summary><strong>π’΅ μ΅°μ‚¬ κ³Όμ •κ³Ό ν•΄κ²°μ±…</strong></summary>

<div class="solution-explanation">

## CUDA-GDBλ΅ λ‹¨κ³„λ³„ μ΅°μ‚¬

### λ””λ²„κ±° μ‹¤ν–‰

```bash
pixi run -e nvidia mojo debug --cuda-gdb --break-on-launch problems/p09/p09.mojo --first-case
```

### λΈλ μ΄ν¬ν¬μΈνΈ μ •λ³΄ ν™•μΈ

CUDA-GDBκ°€ λ©μ¶”λ©΄ λ°”λ΅ μ μ©ν• λ‹¨μ„κ°€ λ‚νƒ€λ‚©λ‹λ‹¤:

```
(cuda-gdb) run
CUDA thread hit breakpoint, p09_add_10_... (output=0x302000000, a=0x0)
    at /home/ubuntu/workspace/mojo-gpu-puzzles/problems/p09/p09.mojo:31
31          i = thread_idx.x
```

**π” μ²« λ²μ§Έ λ‹¨μ„**: ν•¨μ μ‹κ·Έλ‹μ²μ— `(output=0x302000000, a=0x0)`μ΄ λ³΄μ…λ‹λ‹¤

- `output`μ€ μ ν¨ν• GPU λ©”λ¨λ¦¬ μ£Όμ†λ¥Ό κ°€μ§€κ³  μμµλ‹λ‹¤
- `a`λ” `0x0` - null ν¬μΈν„°μ…λ‹λ‹¤!

### μ²΄κ³„μ μΈ λ³€μ κ²€μ‚¬

```
(cuda-gdb) next
32          output[i] = a[i] + 10.0
(cuda-gdb) print i
$1 = 0
(cuda-gdb) print output
$2 = (!pop.scalar<f32> * @register) 0x302000000
(cuda-gdb) print a
$3 = (!pop.scalar<f32> * @register) 0x0
```

**μ¦κ±° μμ§‘**:

- β… μ¤λ λ“ μΈλ±μ¤ `i=0`μ€ μ ν¨ν•©λ‹λ‹¤
- β… κ²°κ³Ό ν¬μΈν„° `0x302000000`μ€ μ¬λ°”λ¥Έ GPU μ£Όμ†μ…λ‹λ‹¤
- β μ…λ ¥ ν¬μΈν„° `0x0`μ€ nullμ…λ‹λ‹¤

### λ¬Έμ  ν™•μΈ

```
(cuda-gdb) print a[i]
Cannot access memory at address 0x0
```

**κ²°μ •μ  μ¦κ±°**: null μ£Όμ†μ λ©”λ¨λ¦¬μ— μ ‘κ·Όν•  μ μ—†μµλ‹λ‹¤ - λ°”λ΅ μ΄κ²ƒμ΄ ν¬λμ‹μ μ›μΈμ…λ‹λ‹¤!

## κ·Όλ³Έ μ›μΈ λ¶„μ„

**λ¬Έμ μ **: μ΄μ  `--first-crash`μ [μ½”λ“](../../../../../problems/p09/p09.mojo)λ¥Ό λ³΄λ©΄, νΈμ¤νΈ μ½”λ“κ°€ GPU λ©”λ¨λ¦¬λ¥Ό μ λ€λ΅ ν• λ‹Ήν•μ§€ μ•κ³  null ν¬μΈν„°λ¥Ό λ§λ“¤κ³  μμµλ‹λ‹¤:

```mojo
 input_buf = ctx.enqueue_create_buffer[dtype](0)  # 0κ°μ μ”μ†λ¥Ό κ°€μ§„ `DeviceBuffer`λ¥Ό μƒμ„±ν•©λ‹λ‹¤. μ”μ†κ°€ 0κ°μ΄λ―€λ΅ λ©”λ¨λ¦¬κ°€ ν• λ‹Ήλμ§€ μ•μ•„ NULL ν¬μΈν„°κ°€ λ©λ‹λ‹¤!
```

**μ™ ν¬λμ‹κ°€ λ°μƒν•λ”κ°€**:

1. `ctx.enqueue_create_buffer[dtype](0)`μ€ 0κ° μ”μ†λ¥Ό κ°€μ§„ `DeviceBuffer`λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
2. ν• λ‹Ήν•  μ”μ†κ°€ μ—†μΌλ‹ null ν¬μΈν„°λ¥Ό λ°ν™ν•©λ‹λ‹¤.
3. μ΄ null ν¬μΈν„°κ°€ GPU kernelλ΅ μ „λ‹¬λ©λ‹λ‹¤.
4. Kernelμ΄ `a[i]`μ— μ ‘κ·Όν•λ ¤ ν•  λ• nullμ„ μ—­μ°Έμ΅° β†’ `CUDA_ERROR_ILLEGAL_ADDRESS`

## μμ • λ°©λ²•

Null ν¬μΈν„° μƒμ„±μ„ μ μ ν• λ²„νΌ ν• λ‹ΉμΌλ΅ κµμ²΄ν•©λ‹λ‹¤:

```mojo
# μλ»λ λ°©λ²•: Null ν¬μΈν„° μƒμ„±
input_buf = ctx.enqueue_create_buffer[dtype](0)

# μ¬λ°”λ¥Έ λ°©λ²•: μ•μ „ν• μ²λ¦¬λ¥Ό μ„ν•΄ μ‹¤μ  GPU λ©”λ¨λ¦¬λ¥Ό ν• λ‹Ήν•κ³  μ΄κΈ°ν™”
input_buf = ctx.enqueue_create_buffer[dtype](SIZE)
input_buf.enqueue_fill(0)
```

## ν•µμ‹¬ λ””λ²„κΉ… κµν›

**ν¨ν„΄ μΈμ‹**:

- `0x0` μ£Όμ†λ” ν•­μƒ null ν¬μΈν„°μ…λ‹λ‹¤
- μ ν¨ν• GPU μ£Όμ†λ” ν° 16μ§„μμ…λ‹λ‹¤ (μ: `0x302000000`)

**λ””λ²„κΉ… μ „λµ**:

1. **ν¬λμ‹ λ©”μ‹μ§€ μ½κΈ°** - λ€μ²΄λ΅ λ¬Έμ  μ ν•μ— λ€ν• ννΈλ¥Ό μ¤λ‹λ‹¤
2. **ν•¨μ νλΌλ―Έν„° ν™•μΈ** - CUDA-GDBκ°€ λΈλ μ΄ν¬ν¬μΈνΈ μ§„μ… μ‹ λ³΄μ—¬μ¤λ‹λ‹¤
3. **λ¨λ“  ν¬μΈν„° κ²€μ‚¬** - μ£Όμ†λ¥Ό λΉ„κµν•΄μ„ nullμ΄λ‚ μλ»λ κ²ƒμ„ μ°Ύμµλ‹λ‹¤
4. **λ©”λ¨λ¦¬ μ ‘κ·Ό ν…μ¤νΈ** - μμƒν• ν¬μΈν„°λ¥Ό μ—­μ°Έμ΅°ν•΄ λ΄…λ‹λ‹¤
5. **ν• λ‹Ή μ§€μ κΉμ§€ μ¶”μ ** - λ¬Έμ μ ν¬μΈν„°κ°€ μ–΄λ””μ„ μƒμ„±λμ—λ”μ§€ μ°Ύμµλ‹λ‹¤

**π’΅ ν•µμ‹¬ ν†µμ°°**: μ΄λ° μ ν•μ null ν¬μΈν„° λ²„κ·Έλ” GPU ν”„λ΅κ·Έλλ°μ—μ„ λ§¤μ° ν”ν•©λ‹λ‹¤. μ—¬κΈ°μ„ λ°°μ΄ μ²΄κ³„μ μΈ CUDA-GDB μ΅°μ‚¬ λ°©λ²•μ€ λ‹¤λ¥Έ λ§μ€ GPU λ©”λ¨λ¦¬ λ¬Έμ , κ²½μ μƒνƒ, kernel ν¬λμ‹λ¥Ό λ””λ²„κΉ…ν•  λ•λ„ κ·Έλ€λ΅ μ μ©λ©λ‹λ‹¤.

</div>
</details>

## λ‹¤μ λ‹¨κ³„: ν¬λμ‹μ—μ„ μ΅°μ©ν• λ²„κ·Έλ΅

**ν¬λμ‹ λ””λ²„κΉ…μ„ μµν”μµλ‹λ‹¤!** μ΄μ  ν•  μ μμµλ‹λ‹¤:

- μ¤λ¥ λ©”μ‹μ§€λ¥Ό λ‹¨μ„λ΅ **GPU ν¬λμ‹λ¥Ό μ²΄κ³„μ μΌλ΅ μ΅°μ‚¬**
- ν¬μΈν„° μ£Όμ† κ²€μ‚¬λ¥Ό ν†µν•΄ **null ν¬μΈν„° λ²„κ·Έ μ‹λ³„**
- λ©”λ¨λ¦¬ κ΄€λ ¨ λ””λ²„κΉ…μ— **CUDA-GDBλ¥Ό ν¨κ³Όμ μΌλ΅ μ‚¬μ©**

### λ‹¤μ λ„μ „: [νƒμ • μμ‚¬: λ‘ λ²μ§Έ μ‚¬λ΅€](./second_case.md)

**κ·Έλ°λ° ν”„λ΅κ·Έλ¨μ΄ ν¬λμ‹ν•μ§€ μ•λ”λ‹¤λ©΄μ”?** μ™„λ²½ν•κ² μ‹¤ν–‰λμ§€λ§ **μλ»λ κ²°κ³Ό**κ°€ λ‚μ¨λ‹¤λ©΄?

[λ‘ λ²μ§Έ μ‚¬λ΅€](./second_case.md)λ” μ „ν€ λ‹¤λ¥Έ μ ν•μ λ””λ²„κΉ… λ„μ „μ…λ‹λ‹¤:

- κΈΈμ΅μ΄κ°€ λμ–΄μ¤„ **ν¬λμ‹ λ©”μ‹μ§€κ°€ μ—†μµλ‹λ‹¤**
- μ΅°μ‚¬ν•  **λλ ·ν• ν¬μΈν„° λ¬Έμ λ„ μ—†μµλ‹λ‹¤**
- λ¬Έμ λ¥Ό κ°€λ¦¬ν‚¤λ” **stack traceλ„ μ—†μµλ‹λ‹¤**
- μ²΄κ³„μ μΈ μ΅°μ‚¬κ°€ ν•„μ”ν• **μλ»λ κ²°κ³Όλ§** μμµλ‹λ‹¤

**μƒλ΅­κ² μµνκ² λ  μ¤ν‚¬:**

- **λ΅μ§ λ²„κ·Έ νƒμ§€** - ν¬λμ‹ μ—†μ΄ μ•κ³ λ¦¬μ¦ μ¤λ¥ μ°ΎκΈ°
- **ν¨ν„΄ λ¶„μ„** - μλ»λ μ¶λ ¥μ—μ„ κ·Όλ³Έ μ›μΈκΉμ§€ κ±°μ¬λ¬ μ¬λΌκ°€κΈ°
- **μ‹¤ν–‰ νλ¦„ λ””λ²„κΉ…** - μµμ ν™” λ•λ¬Έμ— λ³€μ κ²€μ‚¬κ°€ μ• λ  λ• λ€μ²ν•κΈ°

μ—¬κΈ°μ„ λ°°μ΄ μ²΄κ³„μ μΈ μ΅°μ‚¬ λ°©λ²• - λ‹¨μ„ μ½κΈ°, κ°€μ„¤ μ„Έμ°κΈ°, μ²΄κ³„μ μΌλ΅ ν…μ¤νΈν•κΈ° - μ€ μ•μΌλ΅ λ§μ£Όν•  λ” λ―Έλ¬ν• λ΅μ§ μ¤λ¥λ¥Ό λ””λ²„κΉ…ν•λ” κΈ°μ΄κ°€ λ©λ‹λ‹¤.
